name: Status Check - Checklist Enforcer

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  Enforce-PRChecklist:
    runs-on: ubuntu-latest
    steps:
      - name: Enforce PR Checklist
        uses: actions/github-script@v7
        with:
          script: |
            const prBody = context.payload.pull_request.body || "";

            // Regex to find all markdown checkboxes
            const checkboxes = Array.from(prBody.matchAll(/- \[.\]/g)).map(m => m[0]);

            // Find unchecked boxes
            const unchecked = checkboxes.filter(box => box.startsWith("- [ ]"));

            if (unchecked.length > 0) {
              const message = "❌ PR cannot be merged: the following checklist items are not completed:\n\n" +
                              unchecked.join("\n");
              core.setFailed(message);
            } else {
              console.log("✅ All checklist items are completed.");
            }